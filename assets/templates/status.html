<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ“Š Estado del Sistema - Genius en EspaÃ±ol Bot</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}?v=3.0">
    <link rel="icon" type="image/png" sizes="32x32" href="{{ url_for('static', filename='favicon-32x32.png') }}">
    <style>
        .logo-header {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
        }
        
        .logo-header img {
            width: 64px;
            height: 64px;
            margin-right: 15px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        .status-dashboard {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }
        
        .status-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            backdrop-filter: blur(10px);
            border-left: 5px solid;
            transition: transform 0.3s ease;
            animation: fadeIn 0.6s ease-out;
        }
        
        .status-card:hover {
            transform: translateY(-5px);
        }
        
        .status-card.healthy { border-left-color: #27ae60; }
        .status-card.warning { border-left-color: #f9f05d; }
        .status-card.error { border-left-color: #f00622; }
        
        .status-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .status-icon {
            font-size: 2rem;
            margin-right: 15px;
        }
        
        .status-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #4a5568;
        }
        
        .status-value {
            font-size: 1.1rem;
            color: #4a5568;
            margin: 8px 0;
        }
        
        .status-badge {
            display: inline-block;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .badge-online { background: #c6f6d5; color: #22543d; }
        .badge-ready { background: #bee3f8; color: #2a4365; }
        .badge-connected { background: #e9d8fd; color: #44337a; }
        .badge-warning { background: #fed7d7; color: #c53030; }
        
        .metric-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .metric-row:last-child {
            border-bottom: none;
        }
        
        .metric-label {
            font-weight: 500;
            color: #4a5568;
        }
        
        .metric-value {
            font-weight: 600;
            color: #2d3748;
        }
        
        .refresh-button {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: linear-gradient(45deg, #f00622, #c20418);
            color: white;
            border: none;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(240, 6, 34, 0.4);
            transition: all 0.3s ease;
        }
        
        .refresh-button:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(240, 6, 34, 0.6);
        }
        
        .instance-info {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: center;
            color: white;
        }
        
        .instance-id {
            font-family: 'Courier New', monospace;
            font-weight: bold;
            color: #ffd700;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo-header">
                <img src="{{ url_for('static', filename='images/logo.png') }}" alt="Genius en EspaÃ±ol Logo">
                <div>
                    <h1>ğŸ“Š Estado del Sistema</h1>
                    <p class="subtitle">Monitoreo en tiempo real de Genius en EspaÃ±ol Bot</p>
                </div>
            </div>
            
            <div class="instance-info">
                ğŸ¤– <strong>Instancia Activa:</strong> <span class="instance-id">{{ data.get('instance_id', 'N/A') }}</span>
            </div>
        </header>

        <main class="status-grid">
            <!-- Estado General -->
            <div class="status-card {{ 'healthy' if data.status == 'healthy' else 'warning' }}">
                <div class="status-header">
                    <div class="status-icon">{{ 'âœ…' if data.status == 'healthy' else 'âš ï¸' }}</div>
                    <div class="status-title">Estado General</div>
                </div>
                <div class="status-value">
                    <span class="status-badge {{ 'badge-online' if data.status == 'healthy' else 'badge-warning' }}">
                        {{ data.status.upper() }}
                    </span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">â±ï¸ Uptime:</span>
                    <span class="metric-value">{{ data.get('uptime_human', 'N/A') }}</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">ğŸ• Iniciado:</span>
                    <span class="metric-value">{{ data.get('start_time', 'N/A') }}</span>
                </div>
            </div>

            <!-- Bot de Discord -->
            <div class="status-card healthy">
                <div class="status-header">
                    <div class="status-icon">ğŸ¤–</div>
                    <div class="status-title">Bot</div>
                </div>
                <div class="status-value">
                    <span class="status-badge badge-ready">{{ data.bot.status.upper() if data.bot else 'OFFLINE' }}</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">ğŸ° Servidores:</span>
                    <span class="metric-value">{{ data.bot.guilds_count if data.bot else '0' }}</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">ğŸ‘¥ Usuarios:</span>
                    <span class="metric-value">{{ data.bot.users_count if data.bot and data.bot.users_count else 'N/A' }}</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">ğŸ“Š Latencia:</span>
                    <span class="metric-value">{{ data.bot.latency if data.bot and data.bot.latency else 'N/A' }}</span>
                </div>
            </div>

            <!-- Servidor Web -->
            <div class="status-card healthy">
                <div class="status-header">
                    <div class="status-icon">ğŸŒ</div>
                    <div class="status-title">Servidor Web</div>
                </div>
                <div class="status-value">
                    <span class="status-badge badge-online">{{ data.server.status.upper() if data.server else 'OFFLINE' }}</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">ğŸ“¡ Requests:</span>
                    <span class="metric-value">{{ data.server.requests_count if data.server else '0' }}</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">ğŸ’¾ RAM:</span>
                    <span class="metric-value">{{ "%.1f MB"|format(data.server.memory_usage.rss_mb) if data.server and data.server.get('memory_usage') else 'N/A' }}</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">ğŸ”„ Keep-Alive:</span>
                    <span class="metric-value">Activo</span>
                </div>
            </div>

            <!-- Base de Datos -->
            <div class="status-card healthy">
                <div class="status-header">
                    <div class="status-icon">ğŸ—„ï¸</div>
                    <div class="status-title">Base de Datos</div>
                </div>
                <div class="status-value">
                    <span class="status-badge badge-connected">{{ data.database.status.upper() if data.database else 'OFFLINE' }}</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">âœ… Verificados:</span>
                    <span class="metric-value">{{ data.database.verified_users if data.database and data.database.verified_users is not none else '0' }}</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">â³ Pendientes:</span>
                    <span class="metric-value">{{ data.database.pending_verifications if data.database and data.database.pending_verifications is not none else '0' }}</span>
                </div>
            </div>

            <!-- Servicios Externos -->
            <div class="status-card healthy">
                <div class="status-header">
                    <div class="status-icon">âš™ï¸</div>
                    <div class="status-title">Servicios</div>
                </div>
                <div class="metric-row">
                    <span class="metric-label">ğŸµ Genius API:</span>
                    <span class="metric-value">{{ data.services.genius_api.upper() if data.services else 'N/A' }}</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">ğŸ” OAuth:</span>
                    <span class="metric-value">{{ data.services.oauth_flow.upper() if data.services else 'N/A' }}</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">ğŸŒ Discord API:</span>
                    <span class="metric-value">{{ data.services.discord_api.upper() if data.services and data.services.discord_api else 'ONLINE' }}</span>
                </div>
            </div>

            <!-- InformaciÃ³n del Sistema -->
            <div class="status-card healthy">
                <div class="status-header">
                    <div class="status-icon">ğŸ“ˆ</div>
                    <div class="status-title">Sistema</div>
                </div>
                <div class="metric-row">
                    <span class="metric-label">ğŸš€ VersiÃ³n:</span>
                    <span class="metric-value">v2.0.0</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">ğŸ Python:</span>
                    <span class="metric-value">{{ data.get('python_version', '3.11+') }}</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">ğŸ—ï¸ Plataforma:</span>
                    <span class="metric-value">Render.com</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">ğŸ• Ãšltima actividad:</span>
                    <span class="metric-value">{{ data.timestamp if data.timestamp else 'N/A' }}</span>
                </div>
            </div>
        </main>

        <footer>
            <p>ğŸ“… Ãšltima actualizaciÃ³n: {{ data.timestamp if data.timestamp else 'N/A' }}</p>
            <p class="timestamp">ğŸ”„ Auto-actualizaciÃ³n cada 30 segundos</p>
        </footer>
    </div>

    <button class="refresh-button" onclick="location.reload()" title="Actualizar Estado">
        ğŸ”„
    </button>

    <script>
        // Auto-refresh cada 30 segundos
        setTimeout(() => {
            location.reload();
        }, 30000);
        
        // Mostrar tiempo transcurrido desde la Ãºltima actualizaciÃ³n
        let lastUpdate = new Date();
        setInterval(() => {
            const now = new Date();
            const seconds = Math.floor((now - lastUpdate) / 1000);
            document.title = `ğŸ“Š Estado del Sistema (${seconds}s) - Genius en EspaÃ±ol Bot`;
        }, 1000);
    </script>
</body>
</html>